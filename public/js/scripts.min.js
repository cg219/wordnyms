angular.module("WordNyms",["ngRoute","ngResource"]).config(["$routeProvider","$locationProvider",function(router,location){location.html5Mode(!0),router.when("/",{templateUrl:"home.html",controller:"Main"}).when("/game/solo/:player/:round",{templateUrl:"single.html",controller:"SingleGame"}).when("/results/solo/round/:player/:round",{templateUrl:"round.html",controller:"RoundRecap"}).when("/results/solo/final/:player",{templateUrl:"final.html",controller:"FinalStats"})}]).factory("Word",["$resource",function(resource){return resource("/api/nyms/:word")}]).factory("WordList",["$resource",function(resource){return resource("/api/nyms/getList/:level")}]).factory("Player",function(){return{name:"",score:0,roundScore:0,correct:0,streak:0,roundStreak:0,highestStreak:0}}).directive("kmEnter",function(){return{restrict:"A",link:function(scope,element,attrs){element.bind("keypress",function(event){13==event.which&&scope.$eval(attrs.kmEnter)})}}}).controller("Main",["$scope","$location","Player",function(scope,location,player){scope.updateName=function(){player.name=scope.playerName},scope.playSingle=function(){console.log(scope.playerName),""==scope.playerName||""==scope.playerAge||void 0==scope.playerName||void 0==scope.playerAge?alert("Please fill out your name and age."):location.path("/game/solo/"+player.name+"/1")}}]).controller("SingleGame",["$scope","$resource","WordList","Word","$interval","$location","Player","$routeParams",function(scope,resource,wordlist,word,interval,location,player,route){var timerTick,list,gameLevel=1;scope.checkingGuess=!1,scope.roundNumber=route.round,scope.timer=60,gameLevel=1,player.roundStreak=0,player.roundScore=0,player.correct=0,list=wordlist.get({level:gameLevel},function(result){console.log(result),getRandomWord()}),timerTick=interval(function(){scope.timer-=1,scope.timer<=0&&(interval.cancel(timerTick),player.score+=player.roundScore,player.highestStreak=player.roundStreak>player.highestStreak?player.roundStreak:player.highestStreak,scope.checkingGuess||gotoEndPage())},1e3),scope.$watch("antonyms",function(){scope.antonymsLeft=scope.antonyms?scope.antonyms.length:0}),scope.$watch("synonyms",function(){scope.synonymsLeft=scope.synonyms?scope.synonyms.length:0}),scope.$watch("checkingGuess",function(){scope.timer<=0&&(scope.checkingGuess||gotoEndPage())});var getRandomWord=function(){console.log("Getting Random Word"),word.get({word:list.words[_.random(list.words.length)]},function(currentWord){return console.log(currentWord),currentWord.type?(scope.currentWordType=currentWord.type,scope.currentWord=currentWord.word.name,scope.antonyms=currentWord.word.antonyms[currentWord.type],void(scope.synonyms=currentWord.word.synonyms[currentWord.type])):void scope.nextWord()})},updateScore=function(){player.streak++;var levelMultiplier=scope.roundNumber,guessMultiplier=player.streak>=3?10*(player.streak-2):0,baseReward=10*gameLevel;player.roundStreak=player.streak>player.roundStreak?player.streak:player.roundStreak,player.roundScore+=baseReward*levelMultiplier+guessMultiplier,player.correct++,console.log("Score: "+player.roundScore)},gotoEndPage=function(){location.path(3==scope.roundNumber?"/results/solo/final/"+player.name:"/results/solo/round/"+player.name+"/"+scope.roundNumber)};scope.nextWord=function(lastWord){list.words=_.without(list.words,lastWord),getRandomWord(),console.log(list)},scope.guess=function(){var guess=scope.playerGuess.toLowerCase();scope.checkingGuess=!0,_.contains(scope.antonyms,guess)?(scope.antonyms=_.without(scope.antonyms,guess),updateScore(),scope.checkingGuess=!1):_.contains(scope.synonyms,guess)?(scope.synonyms=_.without(scope.synonyms,guess),updateScore(),scope.checkingGuess=!1):(scope.timer-=2,player.streak=0,scope.checkingGuess=!1),scope.playerGuess=""}}]).controller("RoundRecap",["$scope","$resource","Player","$interval","$location","$routeParams",function(scope,resource,player,interval,location,route){scope.player=player,scope.timer=15,scope.roundNumber=route.round,console.log(route);var timerTick=interval(function(){scope.timer-=1,scope.timer<=0&&(interval.cancel(timerTick),location.path("/game/solo/"+player.name+"/"+ ++route.round))},1e3)}]).controller("FinalStats",["$scope","$resource","Player","$interval","$location",function(scope,resource,player){scope.player=player}]);